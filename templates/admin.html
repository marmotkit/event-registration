{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>活動管理</h1>
        <a href="{{ url_for('new_event') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> 新增活動
        </a>
    </div>

    {% for event in events %}
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <h2 class="card-title">{{ event.title }}</h2>
                    <p class="card-text">{{ event.description }}</p>
                    <div class="row">
                        <div class="col-md-6">
                            {% if event.start_date == event.end_date %}
                            <p><i class="fas fa-calendar-alt"></i> 活動日期：{{ event.start_date }}</p>
                            {% else %}
                            <p><i class="fas fa-calendar-alt"></i> 活動日期：{{ event.start_date }} 至 {{ event.end_date }}</p>
                            {% endif %}
                            <p><i class="fas fa-clock"></i> 集合時間：{{ event.meeting_time }}</p>
                            <p><i class="fas fa-map-marker-alt"></i> 活動地點：{{ event.location }}</p>
                            <p><i class="fas fa-dollar-sign"></i> 活動費用：NT$ {{ event.fee }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><i class="fas fa-user"></i> 主辦人：{{ event.organizer }}</p>
                            {% if event.co_organizers %}
                            <p><i class="fas fa-users"></i> 協辦人員：{{ ', '.join(event.co_organizers) }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">報名統計</h5>
                            <p class="mb-2">報名人數：<strong>{{ event.registration_count }} 人</strong></p>
                            <p class="mb-2">已繳費：<strong>NT$ {{ event.paid_amount }}</strong></p>
                            <p class="mb-0">總費用：<strong>NT$ {{ event.total_amount }}</strong></p>
                        </div>
                    </div>
                    <div class="mt-3 d-grid gap-2">
                        <a href="{{ url_for('view_event', event_id=event._id) }}" class="btn btn-info">
                            <i class="fas fa-list"></i> 查看報名名單
                        </a>
                        <a href="{{ url_for('edit_event', event_id=event._id) }}" class="btn btn-warning">
                            <i class="fas fa-edit"></i> 編輯活動
                        </a>
                        <button class="btn btn-danger" onclick="deleteEvent('{{ event._id }}')">
                            <i class="fas fa-trash"></i> 刪除活動
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script>
function deleteEvent(eventId) {
    if (confirm('確定要刪除此活動嗎？此操作無法復原。')) {
        fetch(`/admin/event/${eventId}/delete`, {
            method: 'POST',
        }).then(response => {
            if (response.ok) {
                window.location.reload();
            } else {
                alert('刪除活動時發生錯誤，請稍後再試');
            }
        }).catch(error => {
            console.error('Error:', error);
            alert('刪除活動時發生錯誤，請稍後再試');
        });
    }
}
</script>
{% endblock %}
